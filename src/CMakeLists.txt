# set the sources from which to compile the target library

set(ppic_SOURCES
  r2d_parabolic.c
  m_r2d_parabolic.f90
  )

target_sources(ppic PRIVATE ${ppic_SOURCES})

# What headers should it use and install

set(ppic_HEADERS
  r2d_parabolic.h
  )

list(TRANSFORM ppic_HEADERS PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")

set_target_properties(r3d PROPERTIES
  PUBLIC_HEADER "${ppic_HEADERS}")

# In addition to the include directories of the source, we need to
# include the build or directory to get the autogenerated r3d-config.h
# (The first of these is needed if PPIC is included as a submodule, the
# second is needed for the auto-generated config file if PPIC is
# included as a submodule, the third is to get the autogenerated
# config header if PPIC is being compiled separately (not sure this has
# been input correctly or in the best manner) and the last is for
# dependencies in installations)

target_include_directories(ppic PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
  $<BUILD_INTERFACE:${ppic_BINARY_DIR}>
  $<BUILD_INTERFACE:${CMAKE_BINARY_DIR}>
  $<INSTALL_INTERFACE:include>)

if(CMAKE_Fortran_COMPILER_ID MATCHES "GNU")
    set(dialect "-ffree-form -std=f2008 -fimplicit-none")
    set(bounds "-fbounds-check")
endif()
if(CMAKE_Fortran_COMPILER_ID MATCHES "Intel")
    set(dialect "-stand f08 -free -implicitnone")
    set(bounds "-check bounds")
endif()
if(CMAKE_Fortran_COMPILER_ID MATCHES "PGI")
    set(dialect "-Mfreeform -Mdclchk -Mstandard -Mallocatable=03")
    set(bounds "-C")
endif()

set(CMAKE_Fortran_FLAGS_DEBUG "${CMAKE_Fortran_FLAGS_DEBUG} ${bounds}")
set(CMAKE_Fortran_FLAGS "${CMAKE_Fortran_FLAGS} ${dialect}")
